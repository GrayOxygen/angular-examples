!function(){"use strict";angular.module("common.master",["common.api","common.confirm","common.dateRange","common.drag","common.dragdrop","common.mediaelement","common.modal","common.ngBindHtmlUnsafe","common.print","common.redactor","common.skype","common.strings","common.time","common.upload","common.youtube"])}(),function(){"use strict";angular.module("common.api",[]).factory("Api",["$http",function(a){function b(a){var b="";for(var c in a)if(a[c])switch(typeof a[c]){case"boolean":b+=c+"="+parseInt(a[c],10)+"&";break;case"number":case"string":b+=c+"="+a[c]+"&";break;case"object":for(var d in a[c])a[c][d]&&(b+=c+"["+encodeURIComponent(d)+"]="+encodeURIComponent(a[c][d])+"&")}return b}var c="",d={};return d.setBase=function(a){c=a},d.get=function(d,e){return a.get(c+d+"?"+b(e))},d.post=function(b,d){return a.post(c+b,d)},d.put=function(b,d){return a.put(c+b,d)},d.delete=function(d,e){return a.delete(c+d+"?"+b(e))},d}])}(),function(){"use strict";angular.module("common.confirm",[]).directive("confirm",["$document",function(a){return{restrict:"A",link:function(b,c,d){var e=Math.floor(1e10*Math.random()),f=d.confirmMessage||"",g=d.confirmActionButton||"Yes",h=d.confirmActionClass||"btn-danger",i=d.confirmCancelButton||"No",j=d.confirmTitle||"Confirm",k=d.confirmPlacement||"top";d.buttonId=e;var l="<div class='popover-body' id='button-"+e+"'><span>"+f+"</span><span class='confirm-action-button btn "+h+"'>"+g+"</span> <span class='confirm-cancel-button btn btn-default'>"+i+"</span></div>";c.popover({content:l,html:!0,trigger:"manual",title:j,placement:k}),c.bind("click",function(f){f.stopPropagation(),c.popover("show");var g=$("#button-"+e);g.closest(".popover").click(function(a){a.preventDefault(),a.stopPropagation()}),g.find(".confirm-action-button").click(function(){g.closest(".popover").remove(),b.$apply(function(){b.$eval(d.confirm)})}),g.find(".confirm-cancel-button").click(function(){a.off("click.confirm."+e),g.closest(".popover").remove()}),a.on("click.confirm."+e,":not(.popover, .popover *)",function(){a.off("click.confirm."+e),g.closest(".popover").remove()})})}}}])}(),function(){"use strict";angular.module("common.dateRange",[]).directive("dateRange",["$window","$timeout",function(a,b){return{restrict:"A",scope:{dateRange:"=",ngUpdate:"&"},template:"<i class='icon-calendar'></i> <span></span> <b class='caret'></b>",link:function(c,d){c.dateRangeOptions={ranges:{Today:[new Date,new Date],Yesterday:[moment().subtract("days",1),moment().subtract("days",1)],"Last 7 Days":[moment().subtract("days",6),new Date],"Last 30 Days":[moment().subtract("days",29),new Date],"This Month":[moment().startOf("month"),moment().endOf("month")],"Last Month":[moment().subtract("month",1).startOf("month"),moment().subtract("month",1).endOf("month")]},format:"YYYY-MM-DD",displayFormat:"M/DD/YYYY",separator:" to ",startDate:moment().subtract("days",7).format("M/DD/YYYY"),endDate:moment().format("M/DD/YYYY"),locale:{applyLabel:"Submit",fromLabel:"From",toLabel:"To",customRangeLabel:"Custom Range",daysOfWeek:["Su","Mo","Tu","We","Th","Fr","Sa"],monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],firstDay:1},showWeekNumbers:!1,buttonClasses:["btn-danger"],dateLimit:!1},c.dateRange=angular.extend(c.dateRangeOptions,c.dateRange);var e=a.moment(c.dateRange.startDate).format(c.dateRangeOptions.displayFormat),f=a.moment(c.dateRange.endDate).format(c.dateRangeOptions.displayFormat);$(d).find("span").html(e+" - "+f),d.daterangepicker(c.dateRange,function(a,g){e=a.format(c.dateRangeOptions.displayFormat),f=g.format(c.dateRangeOptions.displayFormat),$(d).find("span").html(e+" - "+f),a=a.format(c.dateRangeOptions.format),g=g.format(c.dateRangeOptions.format),b(function(){c.ngUpdate({start:a,end:g})})})}}}])}(),function(){"use strict";angular.module("common.drag",[]).directive("drag",["$timeout",function(a){return{scope:{drag:"="},link:function(b,c){$(c).draggable({stop:function(c,d){a(function(){b.drag.top=d.position.top,b.drag.left=d.position.left})}})}}}])}(),function(){"use strict";angular.module("common.dragdrop",[]).factory("DragDropHandler",[function(){return{dragObject:void 0,addObject:function(a,b,c){b.splice(c,0,a)},moveObject:function(a,b,c){a.splice(c,0,a.splice(b,1)[0])}}}]).directive("draggable",["DragDropHandler",function(a){return{scope:{draggable:"="},link:function(b,c,d){c.draggable({connectToSortable:d.draggableTarget,helper:"clone",revert:"invalid",start:function(){a.dragObject=b.draggable},stop:function(){a.dragObject=void 0}}),c.disableSelection()}}}]).directive("droppable",["DragDropHandler",function(a){return{scope:{droppable:"=",ngUpdate:"&",ngCreate:"&"},link:function(b,c){c.sortable(),c.disableSelection(),c.on("sortdeactivate",function(d,e){var f=angular.element(e.item).scope().$index,g=c.children().index(e.item);g>=0&&b.$apply(function(){f>=0?(a.moveObject(b.droppable,f,g),b.ngUpdate({from:f,to:g})):(b.ngCreate({object:a.dragObject,to:g}),e.item.remove())})})}}}])}(),function(){"use strict";angular.module("common.mediaelement",[]).directive("mediaelement",[function(){return{restrict:"A",link:function(a,b,c){c.$observe("src",function(){b.mediaelementplayer({videoWidth:-1,videoHeight:-1,audioWidth:400,audioHeight:50,startVolume:.5,loop:!1,enableAutosize:!0,features:["playpause","progress","current","duration","tracks","volume","fullscreen"],alwaysShowControls:!1,iPadUseNativeControls:!1,iPhoneUseNativeControls:!1,AndroidUseNativeControls:!1,alwaysShowHours:!1,showTimecodeFrameCount:!1,framesPerSecond:25,enableKeyboard:!0,pauseOtherPlayers:!0,keyActions:[]})})}}}])}(),function(){"use strict";angular.module("common.modal",[]).directive("modal",["Modal",function(a){return{restrict:"E,A",link:function(b,c,d){c.bind("click",function(){a.load(d.modal,b)})}}}]).factory("Modal",["$http","$compile",function(a,b){var c={};return c.getModal=function(){return $(".modal-service").remove(),c.modalElement=$('<div class="modal-service modal fade"><div class="modal-dialog"><div class="modal-content"></div></div></div>'),c.modalElement.appendTo("body"),c.modalElement},c.compileAndRunPopup=function(a,c){b(a)(c),a.modal()},c.load=function(b,d){a.get(b).success(function(a){var b=c.getModal();b.find(".modal-content").html(a),c.compileAndRunPopup(b,d),b.on("hidden",function(){b.remove()}),b.find(".btn-cancel").click(function(){c.close()})})},c.close=function(){var a=$(".modal-service");a&&a.modal("hide")},c}])}(),function(){"use strict";angular.module("common.ngBindHtmlUnsafe",[]).directive("ngBindHtmlUnsafe",[function(){return function(a,b,c){b.addClass("ng-binding").data("$binding",c.ngBindHtmlUnsafe),a.$watch(c.ngBindHtmlUnsafe,function(a){b.html(a||"")})}}])}(),function(){"use strict";angular.module("common.print",[]).directive("print",["$timeout",function(a){return{link:function(b,c,d){function e(){return $(d.print).html()}c.click(function(){var b=e(),c=window.open("",d.printTitle,"height=400,width=800");return c.document.write("<html><head><title>"+d.printTitle+"</title>"),c.document.write('<link rel="stylesheet" href="/lib/bootstrap/css/bootstrap.min.css" type="text/css" />'),c.document.write("</head><body >"+b+"</body></html>"),c.print(),a(function(){c.close()},10),!0})}}}])}(),function(){"use strict";angular.module("common.redactor",[]).directive("redactor",["$timeout",function(a){return{restrict:"A",require:"ngModel",link:function(b,c,d,e){var f,g=!1;f=c.redactor({imageGetJson:"/api/v1/redactor/images",imageUpload:"/api/v1/redactor/image?resource=true",fileUpload:"/api/v1/redactor/file",plugins:["fontcolor","fullscreen"],syncAfterCallback:function(b){g&&e.$viewValue!==b&&a(function(){e.$setViewValue(b)})}}).redactor("getObject"),e.$render=function(){f.set(e.$viewValue||""),g=!0},b.$on("$destroy",function(){f.destroy(),f=null})}}}])}(),function(){"use strict";angular.module("common.skype",[]).filter("skype",[function(){return function(a){return a?(a=String(a).replace(/\D/g,""),"1"===a[0]&&(a="+"+a),"+"!==a[0]&&"1"!==a[1]&&(a="+1"+a),"skype:"+a+"?call"):a}}])}(),function(){"use strict";angular.module("common.strings",[]).filter("titleCase",function(){var a=function(a){if(a){for(var b=a.split(" "),c=0;c<b.length;c++)b[c]=b[c].charAt(0).toUpperCase()+b[c].slice(1);return b.join(" ")}};return a}).filter("lowerCase",function(){var a=function(a){for(var b=a.split(" "),c=0;c<b.length;c++)b[c]=b[c].charAt(0).toLowerCase()+b[c].slice(1);return b.join(" ")};return a}).filter("nl2br",[function(){return function(a){return a?(a+="",a.replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1<br>$2")):a}}]).filter("truncate",function(){return function(a,b,c){return isNaN(b)&&(b=10),void 0===c&&(c="..."),a?a.length<=b||a.length-c.length<=b?a:String(a).substring(0,b-c.length)+c:a}}).filter("encodeURIComponent",function(){return window.encodeURIComponent}).directive("slugify",["$parse",function(a){return{restrict:"A",require:"ngModel",link:function(b,c,d){b.$watch(d.ngModel,function(c){c&&a(d.ngModel).assign(b,c.toLowerCase().replace(/[\W\s]/g,"-"))})}}}])}(),function(){"use strict";angular.module("common.time",[]).filter("moment",[function(){return function(a,b){return moment(a).format(b)}}]).filter("fromNow",[function(){return function(a){return moment(a).fromNow()}}]).filter("smallFromNow",[function(){return function(a,b){var c,d=function(a,b,c){var d=$.isFunction(a)?a(b,i):a,e=c.numbers&&c.numbers[b]||b;return d.replace(/%d/i,e)},e=(new Date).getTime(),f=new Date(a).getTime(),g=b||!1,h={prefixAgo:null,prefixFromNow:null,suffixAgo:"",suffixFromNow:"",seconds:"1m",minute:"1m",minutes:"%dm",hour:"1h",hours:"%dh",day:"a day",days:"%d days",month:"1mon",months:"%dmon",year:"1y",years:"%dy"},i=e-f,j=Math.abs(i)/1e3,k=j/60,l=k/60,m=l/24,n=m/365,o=void 0===h.wordSeparator?" ":h.wordSeparator,p=h.prefixAgo,q=h.suffixAgo;return g&&0>i&&(p=h.prefixFromNow,q=h.suffixFromNow),c=45>j&&d(h.seconds,Math.round(j),h)||90>j&&d(h.minute,1,h)||45>k&&d(h.minutes,Math.round(k),h)||90>k&&d(h.hour,1,h)||24>l&&d(h.hours,Math.round(l),h)||42>l&&d(h.day,1,h)||30>m&&d(h.days,Math.round(m),h)||45>m&&d(h.month,1,h)||365>m&&d(h.months,Math.round(m/30),h)||1.5>n&&d(h.year,1,h)||d(h.years,Math.round(n),h),$.trim([p,c,q].join(o))}}])}(),function(){"use strict";angular.module("common.upload",[]).directive("upload",["$timeout",function(a){return{restrict:"EA",replace:!1,scope:{upload:"=",ngModel:"=",ngChange:"&",ngError:"&"},transclude:!0,template:"<form style='margin: 0;' method='POST' enctype='multipart/form-data'><input type='file' name='{{ uploadName }}' style='display: none;'/><span style='float: left; position: relative;' class='fake-uploader' readonly='readonly' ng-model='avatar'><span ng-transclude></span><strong ng-show='progress > 0' ng-class='{ \"text-success\": progress == 100, \"text-info\": progress < 100 }' style='width: {{ progress }}%'>{{ progress }}%</strong></span></form>",link:function(b,c,d){b.uploadName=d.uploadName||"file",b.progress=0,b.avatar="",c.find(".fake-uploader").click(function(){c.find('input[type="file"]').click()}),c.find(".progress").css({width:c.find(".fake-uploader").width}),c.find("input").change(function(){var c=$(this),d=c.parents("form");return""===c.val()?!1:(d.attr("action",b.upload),b.$apply(function(){b.progress=0}),d.ajaxSubmit({type:"POST",dataType:"json",uploadProgress:function(a,c,d,e){b.$apply(function(){b.progress=e})},error:function(c,e,f,g){d.removeAttr("action"),a(function(){b.ngError({event:c,responseText:f,statusText:e,form:g})})},success:function(c){d.removeAttr("action");var e=angular.fromJson(c);void 0!==e.filename&&(b.ngModel=e.filename),a(function(){b.ngChange({responseText:c}),b.progress=0})}}),void 0)})}}}])}(),function(){"use strict";angular.module("common.youtube",[]).service("Youtube",[function(){var a=/(?:https?:\/{2})?(?:w{3}\.)?youtu(?:be)?\.(?:com|be)(?:\/watch\?v=|\/)([^\s&]+)/;return{regex:function(){return a}}}]).filter("youtubeIframe",["$filter","Youtube",function(a,b){return function(a){if(!a)return a;var c=a.match(b.regex());return null===c?"":"//www.youtube.com/embed/"+c[1]}}]).filter("youtubeImage",["$filter","Youtube",function(a,b){return function(a){if(!a)return a;var c=a.match(b.regex());return null===c?"":"//i2.ytimg.com/vi/"+c[1]+"/mqdefault.jpg"}}])}();